</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zero-Trust Network Simulator - Interactive Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #64748b;
            font-size: 1.1rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 1rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected { background-color: #10b981; }
        .status-connecting { background-color: #f59e0b; }
        .status-offline { background-color: #ef4444; animation: none; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .model-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .model-buttons {
            background: white;
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 4px;
        }

        .model-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .model-btn.active {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .model-btn.zerotrust.active {
            background: #10b981;
            color: white;
        }

        .model-btn.traditional.active {
            background: #ef4444;
            color: white;
        }

        .model-btn:not(.active) {
            background: transparent;
            color: #64748b;
        }

        .model-btn:not(.active):hover {
            background: #f1f5f9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .network-panel {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }

        .panel-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            flex: 1;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-attack {
            background: #ef4444;
            color: white;
        }

        .btn-attack:hover:not(:disabled) {
            background: #dc2626;
        }

        .btn-activity {
            background: #3b82f6;
            color: white;
        }

        .btn-activity:hover:not(:disabled) {
            background: #2563eb;
        }

        .btn-activity:disabled {
            background: #93c5fd;
        }

        .btn-reset {
            background: #6b7280;
            color: white;
        }

        .btn-reset:hover:not(:disabled) {
            background: #4b5563;
        }

        .network-container {
            position: relative;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            background: #fafafa;
        }

        #networkGraph {
            width: 100%;
            height: 500px;
            cursor: grab;
        }

        #networkGraph:active {
            cursor: grabbing;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node.compromised {
            stroke: #ef4444;
            stroke-width: 4px;
            filter: drop-shadow(0 0 10px #ef4444);
        }

        .node.selected {
            stroke: #3b82f6;
            stroke-width: 3px;
            filter: drop-shadow(0 0 8px #3b82f6);
        }

        .node:hover {
            stroke-width: 2px;
            filter: drop-shadow(0 0 6px rgba(0,0,0,0.3));
        }

        .link {
            stroke: #e2e8f0;
            stroke-opacity: 0.8;
            stroke-width: 2px;
            transition: all 0.3s ease;
        }

        .link.highlighted {
            stroke: #3b82f6;
            stroke-width: 3px;
            stroke-opacity: 1;
        }

        .link.attack-path {
            stroke: #ef4444;
            stroke-width: 4px;
            stroke-dasharray: 8,4;
            animation: dash 2s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -12;
            }
        }

        .node-label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 11px;
            font-weight: 600;
            fill: #1e293b;
            text-anchor: middle;
            pointer-events: none;
            user-select: none;
        }

        .trust-indicator {
            pointer-events: none;
        }

        .device-icon {
            font-size: 16px;
            text-anchor: middle;
            pointer-events: none;
            user-select: none;
            display: none; /* Hide device icons */
        }

        .activity-pulse {
            pointer-events: none;
            opacity: 0;
        }

        .activity-pulse.active {
            animation: pulse-activity 3s ease-out;
        }

        @keyframes pulse-activity {
            0% { opacity: 1; r: 5; }
            50% { opacity: 0.7; r: 15; }
            100% { opacity: 0; r: 25; }
        }

        .legend {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(255, 255, 255, 0.95);
            padding: 16px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .node-info {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            display: none;
        }

        .node-info.visible {
            display: block;
        }

        .node-info h4 {
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-label {
            color: #64748b;
        }

        .info-value {
            font-weight: 600;
        }

        .close-info {
            width: 100%;
            padding: 8px;
            margin-top: 12px;
            background: #f1f5f9;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .close-info:hover {
            background: #e2e8f0;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-panel, .results-panel, .activity-panel {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }

        .panel-title-small {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .activity-feed {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .activity-item.allowed {
            background: #f0fdf4;
            border-color: #10b981;
        }

        .activity-item.denied {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .activity-item.challenged {
            background: #fffbeb;
            border-color: #f59e0b;
        }

        .activity-item.new {
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-user {
            font-weight: 600;
            color: #1e293b;
        }

        .activity-resource {
            color: #64748b;
            font-size: 12px;
        }

        .activity-decision {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 4px;
        }

        .activity-time {
            font-size: 10px;
            color: #9ca3af;
            float: right;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #64748b;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .comparison-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 32px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }

        .comparison-card {
            padding: 24px;
            border-radius: 12px;
            border: 2px solid;
        }

        .comparison-card.zerotrust {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #10b981;
        }

        .comparison-card.traditional {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
        }

        .comparison-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comparison-list {
            list-style: none;
        }

        .comparison-list li {
            margin-bottom: 8px;
            font-size: 14px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .panel-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .controls {
                width: 100%;
                justify-content: stretch;
            }
            
            .control-btn {
                flex: 1;
                justify-content: center;
            }
            
            .model-buttons {
                width: 100%;
            }
            
            .model-btn {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🛡️ Zero-Trust vs Traditional Network Security</h1>
            <p>Interactive demonstration of attack containment and access control</p>
            <div class="connection-status">
                <div class="status-dot status-connecting" id="statusDot"></div>
                <span id="statusText">Connecting to Backend...</span>
                <span id="statusExtra" style="font-size: 12px; color: #f59e0b;"></span>
            </div>
        </div>

        <!-- Model Selection -->
        <div class="model-selector">
            <div class="model-buttons">
                <button class="model-btn zerotrust active" id="zeroTrustBtn">
                    🛡️ Zero-Trust Model
                </button>
                <button class="model-btn traditional" id="traditionalBtn">
                    ⚠️ Traditional Model
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Network Visualization Panel -->
            <div class="network-panel">
                <div class="panel-header">
                    <h2 class="panel-title" id="networkTitle">Network Topology - Zero-Trust</h2>
                    <div class="controls">
                        <button class="control-btn btn-attack" id="attackBtn">
                            ▶️ Launch Attack
                        </button>
                        <button class="control-btn btn-activity" id="activityBtn">
                            🕒 Normal Activity
                        </button>
                        <button class="control-btn btn-reset" id="resetBtn">
                            🔄 Reset
                        </button>
                    </div>
                </div>

                <div class="network-container">
                    <svg id="networkGraph" width="800" height="500"></svg>
                    
                    <!-- Legend -->
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #dcfce7; border: 2px solid #10b981;"></div>
                            <span>High Trust (0.8+)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #fef3c7; border: 2px solid #f59e0b;"></div>
                            <span>Medium Trust (0.6-0.8)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #fee2e2; border: 2px solid #ef4444;"></div>
                            <span>Low Trust (0.6-)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #fee2e2; border: 3px solid #ef4444;"></div>
                            <span>Compromised</span>
                        </div>
                    </div>

                    <!-- Node Info Panel -->
                    <div class="node-info" id="nodeInfo">
                        <h4 id="nodeTitle">Device Info</h4>
                        <div class="info-row">
                            <span class="info-label">Type:</span>
                            <span class="info-value" id="nodeType">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Trust Score:</span>
                            <span class="info-value" id="nodeTrust">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="nodeStatus">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Position:</span>
                            <span class="info-value" id="nodePosition">-</span>
                        </div>
                        <button class="close-info" onclick="hideNodeInfo()">Close</button>
                    </div>

                    <!-- Loading Indicator -->
                    <div class="loading-indicator" id="loadingIndicator">
                        <div class="spinner"></div>
                        <p>Loading network topology...</p>
                        <p style="font-size: 12px; color: #9ca3af; margin-top: 8px;">
                            Connecting to Python backend...
                        </p>
                    </div>
                </div>
            </div>

            <!-- Side Panels -->
            <div class="side-panel">
                <!-- Activity Statistics -->
                <div class="stats-panel">
                    <h3 class="panel-title-small">Access Control Activity</h3>
                    <div class="stat-item">
                        <div class="stat-label">
                            ✅ <span>Allowed</span>
                        </div>
                        <div class="stat-value" style="color: #10b981;" id="allowedCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">
                            ❌ <span>Denied</span>
                        </div>
                        <div class="stat-value" style="color: #ef4444;" id="deniedCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">
                            ⚠️ <span>Challenged</span>
                        </div>
                        <div class="stat-value" style="color: #f59e0b;" id="challengedCount">0</div>
                    </div>
                    <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                        <p style="font-size: 12px; color: #64748b;" id="dataSource">
                            📡 Real-time data from Python backend
                        </p>
                        <div id="activityIndicator" style="margin-top: 8px; display: none;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%; animation: pulse 1s infinite;"></div>
                                <span style="font-size: 12px; color: #3b82f6;">Activity simulation in progress...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attack Results -->
                <div class="results-panel" id="resultsPanel" style="display: none;">
                    <h3 class="panel-title-small">Attack Results</h3>
                    <div class="stat-item">
                        <div class="stat-label">Model:</div>
                        <div class="stat-value" id="resultModel">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Compromised:</div>
                        <div class="stat-value" id="resultCompromised">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Containment:</div>
                        <div class="stat-value" id="resultContainment">-</div>
                    </div>
                    <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                        <div id="attackSummary">
                            <!-- Attack summary will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Live Activity Feed -->
                <div class="activity-panel">
                    <h3 class="panel-title-small" style="display: flex; justify-content: space-between; align-items: center;">
                        <span>Live Activity Feed</span>
                        <div id="liveIndicator" style="display: none;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                                <span style="font-size: 12px; color: #10b981;">Live</span>
                            </div>
                        </div>
                    </h3>
                    <div class="activity-feed" id="activityFeed">
                        <div style="text-align: center; padding: 32px 16px; color: #64748b;">
                            <div style="font-size: 24px; margin-bottom: 12px;">🕒</div>
                            <p style="font-size: 14px; margin-bottom: 8px;">No recent activity</p>
                            <p style="font-size: 12px;">Click "Normal Activity" to simulate user access requests</p>
                            <p style="font-size: 12px; color: #9ca3af; margin-top: 8px;">
                                Activity will stream from Python backend in real-time
                            </p>
                        </div>
                    </div>
                    <div id="feedControls" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #64748b;" id="feedCount">Showing 0 recent activities</span>
                            <button onclick="clearActivityFeed()" style="font-size: 12px; color: #64748b; background: none; border: none; cursor: pointer;">
                                Clear Feed
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Model Comparison -->
        <div class="comparison-section">
            <h3 style="text-align: center; font-size: 1.75rem; font-weight: 700; color: #1e293b; margin-bottom: 8px;">
                Security Model Comparison
            </h3>
            <div class="comparison-grid">
                <div class="comparison-card zerotrust">
                    <h4 class="comparison-title" style="color: #047857;">
                        🛡️ Zero-Trust Model
                    </h4>
                    <ul class="comparison-list" style="color: #065f46;">
                        <li>✅ 95% attack containment</li>
                        <li>✅ Continuous verification</li>
                        <li>✅ Micro-segmentation</li>
                        <li>✅ Least privilege access</li>
                        <li>✅ Real-time threat response</li>
                    </ul>
                </div>
                <div class="comparison-card traditional">
                    <h4 class="comparison-title" style="color: #b91c1c;">
                        ⚠️ Traditional Model
                    </h4>
                    <ul class="comparison-list" style="color: #991b1b;">
                        <li>❌ Full network compromise</li>
                        <li>❌ Perimeter-based security</li>
                        <li>❌ Lateral movement allowed</li>
                        <li>❌ Trust after authentication</li>
                        <li>❌ Slow threat detection</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Backend Integration Status -->
        <div style="text-align: center; margin-top: 24px;">
            <div class="status-indicator">
                <div class="status-dot status-connecting" id="bottomStatusDot"></div>
                <span id="bottomStatusText">🔄 Connecting to Python Backend...</span>
                <span id="bottomStatusExtra" style="font-size: 12px; color: #10b981;"></span>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let networkData = { nodes: [], links: [] };
        let selectedNode = null;
        let currentModel = 'zerotrust';
        let connectionStatus = 'connecting';
        let isAttackRunning = false;
        let isActivityRunning = false;
        let attackProgress = [];
        let realTimeActivity = [];
        let activityStats = { allowed: 0, denied: 0, challenged: 0 };
        let svg, simulation;
        let socket = null;

        // D3.js visualization variables
        let nodeElements, linkElements, labelElements, trustElements, iconElements;

        // Initialize the demo
        function initDemo() {
            svg = d3.select('#networkGraph');
            
            // Setup SVG dimensions
            const container = document.querySelector('.network-container');
            const width = container.clientWidth - 4;
            const height = 500;
            
            svg.attr('width', width).attr('height', height);
            
            // Add event listeners
            setupEventListeners();
            
            // Try to connect to backend
            initializeDemo();
        }

        function setupEventListeners() {
            // Model selection
            document.getElementById('zeroTrustBtn').addEventListener('click', () => switchModel('zerotrust'));
            document.getElementById('traditionalBtn').addEventListener('click', () => switchModel('traditional'));
            
            // Control buttons
            document.getElementById('attackBtn').addEventListener('click', startAttackSimulation);
            document.getElementById('activityBtn').addEventListener('click', startNormalActivity);
            document.getElementById('resetBtn').addEventListener('click', resetNetwork);
            
            // Window resize
            window.addEventListener('resize', resizeGraph);
        }

        function resizeGraph() {
            const container = document.querySelector('.network-container');
            const width = container.clientWidth - 4;
            const height = 500;
            
            svg.attr('width', width).attr('height', height);
            
            if (simulation) {
                simulation.force('center', d3.forceCenter(width / 2, height / 2));
                simulation.alpha(0.3).restart();
            }
        }

        function setupD3Visualization() {
            const width = +svg.attr('width');
            const height = +svg.attr('height');
            
            // Clear any existing elements
            svg.selectAll('*').remove();
            
            // Create simulation
            simulation = d3.forceSimulation(networkData.nodes)
                .force('link', d3.forceLink(networkData.links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-400))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => getNodeRadius(d.type) + 5));
            
            // Create link elements
            linkElements = svg.append('g')
                .attr('class', 'links')
                .selectAll('line')
                .data(networkData.links)
                .enter().append('line')
                .attr('class', 'link');
            
            // Create node groups
            const nodeGroups = svg.append('g')
                .attr('class', 'nodes')
                .selectAll('g')
                .data(networkData.nodes)
                .enter().append('g')
                .attr('class', 'node-group')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            // Add main node circles - colored by trust level
            nodeElements = nodeGroups.append('circle')
                .attr('class', 'node')
                .attr('r', d => getNodeRadius(d.type))
                .attr('fill', d => getNodeTrustColor(d)) // Use trust-based coloring
                .attr('stroke', d => d.is_compromised ? '#ef4444' : '#ffffff')
                .attr('stroke-width', d => d.is_compromised ? 3 : 2)
                .on('click', (event, d) => {
                    event.stopPropagation();
                    selectNode(d);
                })
                .on('mouseover', (event, d) => {
                    highlightConnectedLinks(d);
                })
                .on('mouseout', () => {
                    unhighlightAllLinks();
                });
            
            // Add trust score indicators (smaller circles on top-right)
            trustElements = nodeGroups.append('circle')
                .attr('class', 'trust-indicator')
                .attr('r', 3)
                .attr('cx', d => getNodeRadius(d.type) - 6)
                .attr('cy', d => -getNodeRadius(d.type) + 6)
                .attr('fill', d => getTrustColor(d.trust_score))
                .attr('stroke', '#ffffff')
                .attr('stroke-width', 1)
                .style('opacity', d => d.is_compromised ? 0 : 1);
            
            // Remove device icons - no longer needed
            // iconElements = nodeGroups.append('text')...
            
            // Add labels - use full device ID from backend
            labelElements = nodeGroups.append('text')
                .attr('class', 'node-label')
                .attr('dy', d => getNodeRadius(d.type) + 16)
                .text(d => d.id); // Use full ID from backend
            
            // Add activity pulse circles (initially hidden)
            nodeGroups.append('circle')
                .attr('class', 'activity-pulse')
                .attr('r', 0)
                .attr('fill', 'none')
                .attr('stroke', '#10b981')
                .attr('stroke-width', 2);
            
            // Click on empty space to deselect
            svg.on('click', () => {
                selectNode(null);
            });
            
            // Update positions on tick
            simulation.on('tick', () => {
                linkElements
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                nodeGroups
                    .attr('transform', d => `translate(${d.x},${d.y})`);
            });
        }

        function highlightConnectedLinks(node) {
            linkElements.classed('highlighted', d => 
                d.source.id === node.id || d.target.id === node.id
            );
        }

        function unhighlightAllLinks() {
            linkElements.classed('highlighted', false);
        }

        function updateNodeAppearance() {
            if (!nodeElements) return;
            
            // Update node colors based on trust levels and compromised state
            nodeElements
                .attr('fill', d => getNodeTrustColor(d))
                .attr('stroke', d => d.is_compromised ? '#ef4444' : '#ffffff')
                .attr('stroke-width', d => d.is_compromised ? 3 : 2)
                .classed('compromised', d => d.is_compromised)
                .classed('selected', d => selectedNode && d.id === selectedNode.id);
            
            // Update trust indicators
            if (trustElements) {
                trustElements
                    .attr('fill', d => getTrustColor(d.trust_score))
                    .style('opacity', d => d.is_compromised ? 0 : 1);
            }
            
            // Update labels to show full device ID
            if (labelElements) {
                labelElements.text(d => d.id);
            }
        }

        function getNodeTrustColor(node) {
            if (node.is_compromised) {
                return '#fee2e2'; // Light red for compromised nodes
            }
            
            // Color nodes based on trust score
            const trust = node.trust_score;
            if (trust >= 0.8) {
                return '#dcfce7'; // Light green for high trust
            } else if (trust >= 0.6) {
                return '#fef3c7'; // Light yellow for medium trust
            } else {
                return '#fee2e2'; // Light red for low trust
            }
        }

        function showAttackPaths() {
            if (!linkElements || attackProgress.length === 0 || !isAttackRunning) return;
            
            // Reset all links
            linkElements.classed('attack-path', false);
            
            // Only show attack paths if attack is currently running
            if (isAttackRunning) {
                // Highlight attack paths
                attackProgress.forEach(step => {
                    linkElements.classed('attack-path', d => 
                        (d.source.id === step.source && d.target.id === step.target) ||
                        (d.source.id === step.target && d.target.id === step.source)
                    );
                });
            }
        }

        function clearAttackPaths() {
            if (!linkElements) return;
            // Remove all attack path styling
            linkElements.classed('attack-path', false);
        }

        function showActivityPulse(nodeId, decision) {
            const node = networkData.nodes.find(n => n.id === nodeId);
            if (!node) return;
            
            const color = decision === 'allowed' ? '#10b981' : 
                         decision === 'denied' ? '#ef4444' : '#f59e0b';
            
            // Find the pulse element for this node
            svg.selectAll('.node-group')
                .filter(d => d.id === nodeId)
                .select('.activity-pulse')
                .attr('stroke', color)
                .classed('active', true)
                .transition()
                .duration(3000)
                .on('end', function() {
                    d3.select(this).classed('active', false);
                });
        }

        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function getNodeRadius(type) {
            const sizes = {
                router: 20,
                server: 18,
                workstation: 15,
                mobile: 12,
                iot: 10
            };
            return sizes[type] || 15;
        }

        function getNodeColor(node) {
            // This function is kept for backward compatibility but now uses trust-based coloring
            return getNodeTrustColor(node);
        }

        function getTrustColor(trustScore) {
            if (trustScore >= 0.8) return '#10b981';
            if (trustScore >= 0.6) return '#f59e0b';
            return '#ef4444';
        }

        function selectNode(node) {
            selectedNode = node;
            updateNodeAppearance();
            
            if (node) {
                showNodeInfo(node);
                highlightConnectedLinks(node);
            } else {
                hideNodeInfo();
                unhighlightAllLinks();
            }
        }

        async function initializeDemo() {
            try {
                updateConnectionStatus('connecting', 'Connecting to Python Backend...');
                
                // Try to load data from backend
                await loadNetworkDataFromBackend();
                await loadInitialStats();
                await connectWebSocket();
                updateConnectionStatus('connected', 'Connected', 'Real-time data');
                hideLoadingIndicator();
                setupD3Visualization();
                
            } catch (error) {
                console.error('Failed to connect to backend:', error);
                updateConnectionStatus('offline', 'Running in Demo Mode', 'Demo data only');
                setOfflineDemoMode();
                hideLoadingIndicator();
                setupD3Visualization();
            }
        }

        async function loadNetworkDataFromBackend() {
            const response = await fetch(`/api/network/topology`);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            const data = await response.json();
            networkData = data;
            console.log('Network topology loaded:', data);
        }

        async function loadInitialStats() {
            try {
                const response = await fetch(`/api/network/status`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.stats) {
                        activityStats = data.stats;
                        updateStatsDisplay();
                    }
                }
            } catch (error) {
                console.log('Could not load initial stats');
            }
        }

        function connectWebSocket() {
            return new Promise((resolve, reject) => {
                try {
                    socket = io('https://zerotrustnetworksimulator.wl.r.appspot.com');
                    
                    socket.on('connect', () => {
                        console.log('WebSocket connected');
                        resolve();
                    });
                    
                    socket.on('disconnect', (reason) => {
                        console.log('🔌 WebSocket disconnected:', reason);
                        
                    });
                    
                    socket.on('attack_update', handleAttackUpdate);
                    socket.on('activity_update', handleActivityUpdate);
                    socket.on('network_reset', handleNetworkReset);
                    
                    socket.on('connect_error', (error) => {
                        reject(error);
                    });
                    
                    setTimeout(() => {
                        if (!socket.connected) {
                            reject(new Error('WebSocket connection timeout'));
                        }
                    }, 5000);
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        function setOfflineDemoMode() {
            // Create fallback demo data
            networkData = {
                nodes: [
                    { id: 'firewall-01', type: 'router', trust_score: 0.95, is_compromised: false, x: 400, y: 100 },
                    { id: 'db-server-01', type: 'server', trust_score: 0.85, is_compromised: false, x: 500, y: 200 },
                    { id: 'ws-finance-01', type: 'workstation', trust_score: 0.8, is_compromised: false, x: 200, y: 300 },
                    { id: 'ws-it-01', type: 'workstation', trust_score: 0.95, is_compromised: false, x: 600, y: 300 },
                    { id: 'printer-01', type: 'iot', trust_score: 0.4, is_compromised: false, x: 700, y: 400 }
                ],
                links: [
                    { source: 'firewall-01', target: 'db-server-01' },
                    { source: 'firewall-01', target: 'ws-finance-01' },
                    { source: 'firewall-01', target: 'ws-it-01' },
                    { source: 'firewall-01', target: 'printer-01' },
                    { source: 'ws-it-01', target: 'printer-01' }
                ]
            };
            
            // Update data source indicator
            document.getElementById('dataSource').textContent = '🎭 Demo simulation data';
            console.log('Offline demo mode activated');
        }

        function updateConnectionStatus(status, text, extra = '') {
            connectionStatus = status;
            
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const statusExtra = document.getElementById('statusExtra');
            const bottomStatusDot = document.getElementById('bottomStatusDot');
            const bottomStatusText = document.getElementById('bottomStatusText');
            const bottomStatusExtra = document.getElementById('bottomStatusExtra');
            
            // Update status indicators
            statusDot.className = `status-dot status-${status}`;
            bottomStatusDot.className = `status-dot status-${status}`;
            statusText.textContent = text;
            bottomStatusText.textContent = status === 'connected' ? '🐍 Connected to Python Backend' : 
                                          status === 'connecting' ? '🔄 Connecting to Python Backend...' : 
                                          '🎭 Running in Demo Mode';
            statusExtra.textContent = extra;
            bottomStatusExtra.textContent = extra;
            
            // Update data source
            const dataSource = document.getElementById('dataSource');
            if (dataSource) {
                dataSource.textContent = status === 'connected' ? 
                    '📡 Real-time data from Python backend' : 
                    '🎭 Demo simulation data';
            }
        }

        function hideLoadingIndicator() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }

        function showNodeInfo(node) {
            const nodeInfo = document.getElementById('nodeInfo');
            const nodeTitle = document.getElementById('nodeTitle');
            const nodeType = document.getElementById('nodeType');
            const nodeTrust = document.getElementById('nodeTrust');
            const nodeStatus = document.getElementById('nodeStatus');
            const nodePosition = document.getElementById('nodePosition');
            
            // Show full device ID without icon
            nodeTitle.innerHTML = node.id;
            nodeType.textContent = node.type.charAt(0).toUpperCase() + node.type.slice(1);
            nodeTrust.textContent = `${(node.trust_score * 100).toFixed(1)}%`;
            nodeTrust.style.color = getTrustColor(node.trust_score);
            nodeStatus.textContent = node.is_compromised ? 'Compromised' : 'Secure';
            nodeStatus.style.color = node.is_compromised ? '#ef4444' : '#10b981';
            nodePosition.textContent = `(${Math.round(node.x)}, ${Math.round(node.y)})`;
            
            nodeInfo.classList.add('visible');
        }

        function hideNodeInfo() {
            selectedNode = null;
            document.getElementById('nodeInfo').classList.remove('visible');
        }

        function switchModel(model) {
            if (currentModel === model) return;
            
            currentModel = model;
            
            // Update UI
            const zeroTrustBtn = document.getElementById('zeroTrustBtn');
            const traditionalBtn = document.getElementById('traditionalBtn');
            const networkTitle = document.getElementById('networkTitle');
            const activityBtn = document.getElementById('activityBtn');
            const zeroTrustOnlyNote = document.getElementById('zeroTrustOnlyNote');
            const activityFeedHint = document.getElementById('activityFeedHint');
            
            if (model === 'zerotrust') {
                zeroTrustBtn.classList.add('active');
                traditionalBtn.classList.remove('active');
                networkTitle.textContent = 'Network Topology - Zero-Trust';
                // Show activity button for zero-trust model
                activityBtn.style.display = 'flex';
                if (zeroTrustOnlyNote) zeroTrustOnlyNote.style.display = 'none';
                if (activityFeedHint) activityFeedHint.textContent = 'Click "Normal Activity" to simulate user access requests';
            } else {
                traditionalBtn.classList.add('active');
                zeroTrustBtn.classList.remove('active');
                networkTitle.textContent = 'Network Topology - Traditional';
                // Hide activity button for traditional model
                activityBtn.style.display = 'none';
                if (zeroTrustOnlyNote) zeroTrustOnlyNote.style.display = 'block';
                if (activityFeedHint) activityFeedHint.textContent = 'Activity simulation only available in Zero-Trust mode';
            }
            
            // Reset attack state when switching models
            resetAttackState();
        }

        async function startAttackSimulation() {
            if (isAttackRunning) return;
            
            isAttackRunning = true;
            attackProgress = [];
            hideAttackResults();
            updateAttackButton();
            
            try {
                if (connectionStatus === 'connected') {
                    const response = await fetch(`/api/simulate/attack`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            attack_type: 'lateral_movement',
                            model: currentModel,
                            entry_point: 'ws-finance-01'
                        })
                    });
                    
                    if (!response.ok) throw new Error('API call failed');
                    console.log('Attack simulation started via API');
                } else {
                    simulateAttackFallback();
                }
            } catch (error) {
                console.error('Attack API failed, using fallback:', error);
                simulateAttackFallback();
            }
        }

        function simulateAttackFallback() {
            console.log(`Running fallback ${currentModel} attack simulation`);
            
            const steps = currentModel === 'traditional' ? 
                generateTraditionalAttack() : 
                generateZeroTrustAttack();
            
            let stepIndex = 0;
            const interval = setInterval(() => {
                if (stepIndex < steps.length) {
                    const step = steps[stepIndex];
                    attackProgress.push(step);
                    updateNetworkVisualization(step.compromised_nodes);
                    stepIndex++;
                } else {
                    clearInterval(interval);
                    isAttackRunning = false;
                    updateAttackButton();
                    clearAttackPaths(); // Clear attack paths when attack completes
                    showAttackResults({
                        model: currentModel,
                        compromised_count: steps[steps.length - 1]?.compromised_nodes.length || 1,
                        total_nodes: networkData.nodes.length,
                        containment_effectiveness: currentModel === 'zerotrust' ? '95%' : '0%'
                    });
                }
            }, 1200);
        }

        function generateTraditionalAttack() {
            if (!networkData.nodes.length) return [];
            
            const allNodes = networkData.nodes.map(n => n.id);
            const steps = [];
            let compromised = ['ws-finance-01'];
            
            allNodes.forEach(node => {
                if (node !== 'ws-finance-01') {
                    compromised.push(node);
                    steps.push({
                        source: compromised[Math.floor(Math.random() * (compromised.length - 1))],
                        target: node,
                        result: 'success',
                        compromised_nodes: [...compromised]
                    });
                }
            });
            
            return steps;
        }

        function generateZeroTrustAttack() {
            if (!networkData.nodes.length) return [];
            
            const possibleTargets = networkData.nodes
                .filter(n => n.id !== 'ws-finance-01')
                .slice(0, 3)
                .map(n => n.id);
            
            return possibleTargets.map(target => ({
                source: 'ws-finance-01',
                target: target,
                result: 'blocked',
                compromised_nodes: ['ws-finance-01']
            }));
        }

        async function startNormalActivity() {
            if (isActivityRunning) return;
            
            isActivityRunning = true;
            clearActivityFeed();
            updateActivityButton();
            showActivityIndicator();
            
            try {
                if (connectionStatus === 'connected') {
                    const response = await fetch(`/api/simulate/activity`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ duration_minutes: 2 })
                    });
                    
                    if (!response.ok) throw new Error('API call failed');
                    console.log('Activity simulation started via API');
                } else {
                    simulateActivityFallback();
                }
                
                // Auto-stop after 2 minutes
                setTimeout(() => {
                    isActivityRunning = false;
                    updateActivityButton();
                    hideActivityIndicator();
                }, 20000);
                
            } catch (error) {
                console.error('Activity API failed, using fallback:', error);
                simulateActivityFallback();
            }
        }

        function simulateActivityFallback() {
            console.log('Running fallback activity simulation');
            
            const activities = ['email_access', 'file_share', 'database_query', 'printer_job', 'web_app', 'admin_panel'];
            const decisions = ['allowed', 'denied', 'challenged'];
            const users = ['alice.finance', 'bob.it', 'carol.hr', 'dave.sales', 'eve.contractor'];
            
            const interval = setInterval(() => {
                if (!isActivityRunning) {
                    clearInterval(interval);
                    return;
                }
                
                const activity = {
                    user: users[Math.floor(Math.random() * users.length)],
                    resource: activities[Math.floor(Math.random() * activities.length)],
                    decision: decisions[Math.floor(Math.random() * decisions.length)],
                    timestamp: Date.now()
                };
                
                addActivityToFeed(activity);
                updateActivityStats(activity.decision);
                
            }, 1500);
            
            setTimeout(() => {
                clearInterval(interval);
                isActivityRunning = false;
                updateActivityButton();
                hideActivityIndicator();
            }, 12000);
        }

        async function resetNetwork() {
            try {
                if (connectionStatus === 'connected') {
                    const response = await fetch(`/api/reset`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (response.ok) {
                        console.log('Network reset via API');
                    }
                }
            } catch (error) {
                console.log('Reset API failed, performing local reset');
            }
            
            // Local reset
            resetAttackState();
            clearActivityFeed();
            activityStats = { allowed: 0, denied: 0, challenged: 0 };
            updateStatsDisplay();
            hideNodeInfo();
            hideAttackResults();
        }

        function resetAttackState() {
            isAttackRunning = false;
            attackProgress = [];
            updateAttackButton();
            clearAttackPaths(); // Clear attack paths when resetting
            
            // Reset node compromised status
            networkData.nodes.forEach(node => {
                node.is_compromised = false;
            });
            
            updateNodeAppearance();
        }

        function updateNetworkVisualization(compromisedNodes) {
            networkData.nodes.forEach(node => {
                node.is_compromised = compromisedNodes.includes(node.id);
            });
            updateNodeAppearance();
            showAttackPaths();
        }

        function updateAttackButton() {
            const btn = document.getElementById('attackBtn');
            btn.textContent = isAttackRunning ? '⏹️ Stop Attack' : '▶️ Launch Attack';
            btn.disabled = isAttackRunning;
        }

        function updateActivityButton() {
            const btn = document.getElementById('activityBtn');
            if (isActivityRunning) {
                btn.innerHTML = '🕒 Activity Running... <div style="display: inline-block; width: 12px; height: 12px; border: 2px solid white; border-top: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 8px;"></div>';
                btn.disabled = true;
            } else {
                btn.innerHTML = '🕒 Normal Activity';
                btn.disabled = false;
            }
        }

        function showActivityIndicator() {
            document.getElementById('activityIndicator').style.display = 'block';
            document.getElementById('liveIndicator').style.display = 'flex';
        }

        function hideActivityIndicator() {
            document.getElementById('activityIndicator').style.display = 'none';
            document.getElementById('liveIndicator').style.display = 'none';
        }

        function addActivityToFeed(activity) {
            realTimeActivity.unshift(activity);
            if (realTimeActivity.length > 10) {
                realTimeActivity.pop();
            }
            
            updateActivityFeedDisplay();
            
            // Show activity pulse on a random workstation or server
            const eligibleNodes = networkData.nodes.filter(n => 
                n.type === 'workstation' || n.type === 'server' || n.type === 'mobile'
            );
            if (eligibleNodes.length > 0) {
                const randomNode = eligibleNodes[Math.floor(Math.random() * eligibleNodes.length)];
                showActivityPulse(randomNode.id, activity.decision);
            }
        }

        function updateActivityFeedDisplay() {
            const feed = document.getElementById('activityFeed');
            const controls = document.getElementById('feedControls');
            
            if (realTimeActivity.length === 0) {
                feed.innerHTML = `
                    <div style="text-align: center; padding: 32px 16px; color: #64748b;">
                        <div style="font-size: 24px; margin-bottom: 12px;">🕒</div>
                        <p style="font-size: 14px; margin-bottom: 8px;">No recent activity</p>
                        <p style="font-size: 12px;">Click "Normal Activity" to simulate user access requests</p>
                    </div>
                `;
                controls.style.display = 'none';
            } else {
                feed.innerHTML = realTimeActivity.map((activity, index) => `
                    <div class="activity-item ${activity.decision} ${index === 0 ? 'new' : ''}" style="position: relative;">
                        <div style="display: flex; justify-content: space-between;">
                            <div style="flex: 1;">
                                <div class="activity-user">${activity.user}</div>
                                <div class="activity-resource">${activity.resource}</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="activity-decision" style="color: ${activity.decision === 'allowed' ? '#10b981' : activity.decision === 'denied' ? '#ef4444' : '#f59e0b'}">
                                    ${activity.decision.toUpperCase()}
                                </div>
                                <div class="activity-time">${new Date(activity.timestamp).toLocaleTimeString()}</div>
                            </div>
                        </div>
                        ${activity.decision === 'denied' ? '<div style="margin-top: 4px; font-size: 11px; color: #ef4444;">🚫 Zero-trust policy blocked access</div>' : ''}
                        ${activity.decision === 'challenged' ? '<div style="margin-top: 4px; font-size: 11px; color: #f59e0b;">⚠️ Additional verification required</div>' : ''}
                    </div>
                `).join('');
                
                controls.style.display = 'flex';
                document.getElementById('feedCount').textContent = `Showing ${realTimeActivity.length} recent activities`;
            }
        }

        function clearActivityFeed() {
            realTimeActivity = [];
            updateActivityFeedDisplay();
        }

        function updateActivityStats(decision) {
            activityStats[decision]++;
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('allowedCount').textContent = activityStats.allowed || 0;
            document.getElementById('deniedCount').textContent = activityStats.denied || 0;
            document.getElementById('challengedCount').textContent = activityStats.challenged || 0;
        }

        function showAttackResults(results) {
            const panel = document.getElementById('resultsPanel');
            const model = document.getElementById('resultModel');
            const compromised = document.getElementById('resultCompromised');
            const containment = document.getElementById('resultContainment');
            const summary = document.getElementById('attackSummary');
            
            model.textContent = results.model === 'zerotrust' ? 'Zero-Trust' : 'Traditional';
            model.style.color = results.model === 'zerotrust' ? '#10b981' : '#ef4444';
            
            compromised.textContent = `${results.compromised_count}/${results.total_nodes}`;
            
            containment.textContent = results.containment_effectiveness;
            containment.style.color = results.containment_effectiveness === '95%' ? '#10b981' : '#ef4444';
            
            if (results.model === 'traditional') {
                summary.innerHTML = `
                    <div style="color: #ef4444; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 8px;">⚠️</div>
                        <p style="font-weight: 600; margin-bottom: 4px;">Complete Network Compromise</p>
                        <p style="font-size: 12px;">Lateral movement succeeded</p>
                    </div>
                `;
            } else {
                summary.innerHTML = `
                    <div style="color: #10b981; text-align: center;">
                        <div style="font-size: 24px; margin-bottom: 8px;">🛡️</div>
                        <p style="font-weight: 600; margin-bottom: 4px;">Attack Contained</p>
                        <p style="font-size: 12px;">Zero-trust policies effective</p>
                    </div>
                `;
            }
            
            panel.style.display = 'block';
        }

        function hideAttackResults() {
            document.getElementById('resultsPanel').style.display = 'none';
        }

        // WebSocket event handlers
        function handleAttackUpdate(data) {
            if (data.type === 'attack_progress') {
                attackProgress.push(data.step);
                updateNetworkVisualization(data.compromised_nodes);
            } else if (data.type === 'attack_complete') {
                isAttackRunning = false;
                updateAttackButton();
                clearAttackPaths(); // Clear attack paths when attack completes
                showAttackResults(data.results);
            }
        }

        function handleActivityUpdate(data) {
            if (data.type === 'activity_update') {
                addActivityToFeed({
                    user: data.user,
                    resource: data.resource,
                    decision: data.decision,
                    timestamp: data.timestamp
                });
                
                if (data.stats) {
                    activityStats = data.stats;
                    updateStatsDisplay();
                }
            }
        }

        function handleNetworkReset() {
            resetAttackState();
            clearActivityFeed();
            activityStats = { allowed: 0, denied: 0, challenged: 0 };
            updateStatsDisplay();
            hideNodeInfo();
            hideAttackResults();
            clearAttackPaths(); // Clear attack paths on network reset
        }

        // Initialize when page loads
        window.addEventListener('load', initDemo);
        window.addEventListener('beforeunload', () => {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (socket) {
                socket.disconnect();
            }
        });
    </script>
</body>
</html>